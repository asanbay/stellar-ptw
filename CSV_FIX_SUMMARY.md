# üéâ CSV Import/Export - Cross-Platform Fix

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚úÖ Windows Excel —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **UTF-8 BOM** –¥–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ Excel
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è** (`;` –¥–ª—è RU/TR –ª–æ–∫–∞–ª–µ–π, `,` –¥–ª—è EN)
- **Windows-style –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫** (`\r\n` –≤–º–µ—Å—Ç–æ `\n`)
- **–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è** –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä CSV
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–ø–æ–ª–µ–π –≤ –∫–∞–≤—ã—á–∫–∞—Ö** —Å –∑–∞–ø—è—Ç—ã–º–∏/—Ç–æ—á–∫–∞–º–∏ —Å –∑–∞–ø—è—Ç–æ–π –≤–Ω—É—Ç—Ä–∏
- –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ **–¥–≤–æ–π–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫** (`""` –≤–Ω—É—Ç—Ä–∏ –¥–∞–Ω–Ω—ã—Ö)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è** (`,` –∏–ª–∏ `;`)
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ **–≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å—Ç—Ä–æ–∫** (Windows/Mac/Linux)

### ‚úÖ –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ **—Ä—É—Å—Å–∫–æ–º/—Ç—É—Ä–µ—Ü–∫–æ–º/–∞–Ω–≥–ª–∏–π—Å–∫–æ–º**
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- **[IMPORT_CSV_GUIDE.md](IMPORT_CSV_GUIDE.md)** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–º–ø–æ—Ä—Ç—É –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
- **[WINDOWS_CSV_FIX.md](WINDOWS_CSV_FIX.md)** - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –Ω–∞ Windows

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
–°–º. –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/components/ImportPersonnelDialog.tsx`:
- `downloadTemplate()` - —ç–∫—Å–ø–æ—Ä—Ç —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- `parseFile()` - –∏–º–ø–æ—Ä—Ç —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è
- `parseCSVLine()` - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–∞—Ä—Å–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π escaping

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –≠–∫—Å–ø–æ—Ä—Ç (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞)

```typescript
// 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏ –≤—ã–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
const isWindowsLikeLocale = navigator.language.includes('ru') || 
                             navigator.language.includes('tr') ||
                             navigator.platform.includes('Win')
const delimiter = isWindowsLikeLocale ? ';' : ','

// 2. –î–æ–±–∞–≤–ª—è–µ–º UTF-8 BOM –¥–ª—è Excel
const BOM = '\uFEFF'

// 3. –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —è—á–µ–π–∫–∏ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏/–∫–∞–≤—ã—á–∫–∞–º–∏
cell.includes(delimiter) ? `"${cell.replace(/"/g, '""')}"` : cell

// 4. –ò—Å–ø–æ–ª—å–∑—É–µ–º Windows line endings
.join('\r\n')

// 5. –°–æ–∑–¥–∞–µ–º Blob —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–∏–ø–æ–º
new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' })
```

### –ò–º–ø–æ—Ä—Ç (—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞)

```typescript
// 1. –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è
const detectDelimiter = (text: string): string => {
  const firstLine = text.split('\n')[0]
  const commaCount = (firstLine.match(/,/g) || []).length
  const semicolonCount = (firstLine.match(/;/g) || []).length
  return semicolonCount > commaCount ? ';' : ','
}

// 2. –ü–∞—Ä—Å–∏–Ω–≥ —Å —É—á–µ—Ç–æ–º –∫–∞–≤—ã—á–µ–∫ –∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
const parseCSVLine = (line: string, delimiter: string): string[] => {
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º quoted fields
  // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ ("")
  // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–≤—ã—á–µ–∫ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
}
```

## üîÑ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
|--------|-----------|-------------|-----------|
| CSV UTF-8 BOM | Windows RU/TR | `;` | ‚úÖ –ü–æ–ª–Ω–∞—è |
| CSV UTF-8 BOM | Windows EN | `,` | ‚úÖ –ü–æ–ª–Ω–∞—è |
| CSV UTF-8 | Mac/Linux | `,` | ‚úÖ –ü–æ–ª–Ω–∞—è |
| CSV ANSI | Windows (—Å—Ç–∞—Ä—ã–π) | `;` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è |
| XLSX/XLS | –õ—é–±–∞—è | - | ‚ùå –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ CSV |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

**Windows:**
1. –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω
2. –û—Ç–∫—Ä—ã—Ç—å –¥–≤–æ–π–Ω—ã–º –∫–ª–∏–∫–æ–º –≤ Excel
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä—É—Å—Å–∫–∏–µ/—Ç—É—Ä–µ—Ü–∫–∏–µ –±—É–∫–≤—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ "CSV UTF-8"
6. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

**Mac:**
1. –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω
2. –û—Ç–∫—Ä—ã—Ç—å –≤ Numbers –∏–ª–∏ Excel
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
4. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ CSV
5. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

**Linux:**
1. –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω
2. –û—Ç–∫—Ä—ã—Ç—å –≤ LibreOffice Calc
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ CSV UTF-8
6. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

## üìä –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–ø—è—Ç–∞—è –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å):
```csv
Name,Position,Role,Email,Phone
John Doe,Engineer,worker,john@example.com,+1234567890
```

### –î–∞–Ω–Ω—ã–µ —Å –∫–∞–≤—ã—á–∫–∞–º–∏ (—Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å):
```csv
–ò–º—è;–î–æ–ª–∂–Ω–æ—Å—Ç—å;–†–æ–ª—å;Email;–¢–µ–ª–µ—Ñ–æ–Ω
"–ò–≤–∞–Ω–æ–≤, –ò–≤–∞–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á";–ò–Ω–∂–µ–Ω–µ—Ä;worker;ivan@example.com;+79991234567
"–û–û–û ""–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞""";–î–∏—Ä–µ–∫—Ç–æ—Ä;issuer;director@example.com;+79991234568
```

## üéì –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### UTF-8 BOM
- –ë–∞–π—Ç—ã: `EF BB BF`
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–∫–∞–∑—ã–≤–∞–µ—Ç Excel —á—Ç–æ —Ñ–∞–π–ª –≤ UTF-8
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Windows Excel

### –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- **–°–®–ê, UK, –ö–∏—Ç–∞–π:** –∑–∞–ø—è—Ç–∞—è `,` (—Ç.–∫. —Ç–æ—á–∫–∞ = –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å)
- **–†–æ—Å—Å–∏—è, –ì–µ—Ä–º–∞–Ω–∏—è, –§—Ä–∞–Ω—Ü–∏—è:** —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π `;` (—Ç.–∫. –∑–∞–ø—è—Ç–∞—è = –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å)
- **–¢—É—Ä—Ü–∏—è:** —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π `;`

### Line Endings
- **Windows:** `\r\n` (CRLF) - 2 –±–∞–π—Ç–∞
- **Mac (—Å—Ç–∞—Ä—ã–π):** `\r` (CR) - 1 –±–∞–π—Ç
- **Mac/Linux:** `\n` (LF) - 1 –±–∞–π—Ç
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π:** `\r\n` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: Excel –Ω–∞ Windows –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤ –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (–∑–∞–ø—è—Ç–∞—è –≤–º–µ—Å—Ç–æ —Ç–æ—á–∫–∏ —Å –∑–∞–ø—è—Ç–æ–π)
**–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –†—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –∏–µ—Ä–æ–≥–ª–∏—Ñ—ã
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç UTF-8 BOM
**–†–µ—à–µ–Ω–∏–µ:** BOM –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–º–ø–æ—Ä—Ç –ª–æ–º–∞–µ—Ç—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∑–∞–ø—è—Ç—ã–º–∏
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ—Å—Ç–æ–π split(',') –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç quoted fields
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–∞—Ä—Å–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞–≤—ã—á–µ–∫

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–≠–∫—Å–ø–æ—Ä—Ç:** ~1-5ms –¥–ª—è 100 –∑–∞–ø–∏—Å–µ–π
- **–ò–º–ø–æ—Ä—Ç:** ~10-50ms –¥–ª—è 100 –∑–∞–ø–∏—Å–µ–π
- **–ü–∞—Ä—Å–∏–Ω–≥:** ~0.1-0.5ms –Ω–∞ —Å—Ç—Ä–æ–∫—É

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–î–∞—Ç–∞:** 28 –Ω–æ—è–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è:** 1.0.0
